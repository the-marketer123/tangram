<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tangram Puzzle</title>
  
    <!-- p5.js -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.8/lib/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.8/lib/addons/p5.sound.min.js"></script>
  
    <style>
        html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        }
        canvas {
        display: block;
        }
    </style>
</head>
<body>
    <script>

        /* Prerequisites */
            let uiCanvas;
            let user;

            function setup() {
                uiCanvas = createCanvas(windowWidth, windowHeight).elt;

                user = (function (controls) {
                    controls.mX = controls.mY = 0;
                    controls.mP = controls.mC = false;
                    controls.kH = {};
                    controls.kC = {};

                    // Mouse movement
                    uiCanvas.onmousemove = function (e) {
                        controls.mX = e.offsetX;
                        controls.mY = e.offsetY;
                    };

                    // Mouse down
                    uiCanvas.onmousedown = function () {
                        if (!controls.mP) controls.mC = true;
                        controls.mP = true;
                    };

                    // Mouse up
                    uiCanvas.onmouseup = function () {
                        controls.mP = false;
                    };

                    // Touch movement (track only first touch)
                    uiCanvas.ontouchmove = function (e) {
                        if (e.touches.length > 0) {
                            const rect = uiCanvas.getBoundingClientRect();
                            const touch = e.touches[0]; // first finger only
                            controls.mX = touch.clientX - rect.left;
                            controls.mY = touch.clientY - rect.top;
                        }
                        e.preventDefault(); // stop page scrolling/zooming
                    };

                    // Touch down (first touch only)
                    uiCanvas.ontouchstart = function (e) {
                        if (!controls.mP) controls.mC = true;
                        controls.mP = true;

                        if (e.touches.length > 0) {
                            const rect = uiCanvas.getBoundingClientRect();
                            const touch = e.touches[0];
                            controls.mX = touch.clientX - rect.left;
                            controls.mY = touch.clientY - rect.top;
                        }
                        e.preventDefault();
                    };

                    // Touch up (when all touches released)
                    uiCanvas.ontouchend = function (e) {
                        if (e.touches.length === 0) {
                            controls.mP = false;
                        }
                        e.preventDefault();
                    };

                    // Keyboard down
                    document.onkeydown = function (e) {
                        const key = normalizeKey(e);
                        if (controls.kH[key] !== true) {
                            controls.kC[key] = true;
                        } else {
                            controls.kC[key] = false;
                        }
                        controls.kH[key] = true;
                    };

                    // Keyboard up
                    document.onkeyup = function (e) {
                        const key = normalizeKey(e);
                        controls.kH[key] = false;
                    };

                    controls.update = function () {
                        controls.kC = {};
                        controls.mC = false;
                    };

                    function normalizeKey(e) {
                        if (e.key.length === 1) {
                            return e.key.toLowerCase(); // letters & symbols
                        }
                        return e.key; // keep ArrowUp, Shift, Enter, etc.
                    }

                    return controls;
                })({});
            }


        /*rest*/


            let shapes = [
                {
                    draw: function(x,y){
                        noStroke();
                        fill(200,50,50);
                        rect(x+0,y+0,150,50);
                    },
                    x: 0+window.innerWidth/2-175,
                    y: 0+window.innerHeight/2-175,
                    wx: window.innerWidth,
                    wy: window.innerHeight,
                },                
                {
                    draw: function(x,y){
                        noStroke();
                        fill(50,200,50);
                        beginShape();

                        // vertices
                        vertex(x, y);
                        vertex(x+150, y);
                        vertex(x+150, y+257.243);
                        vertex(x, y+300);


                        endShape(CLOSE);                    
                    },
                    x: 0+window.innerWidth/2-175,
                    y: 50+window.innerHeight/2-175,
                    wx: window.innerWidth,
                    wy: window.innerHeight,
                },               
                {
                    draw: function(x,y){
                        noStroke();
                        fill(50,50,200);

                        beginShape();

                        // vertices
                        vertex(x, y);
                        vertex(x+200, y);
                        vertex(x+200, y+150);
                        vertex(x+150, y+150);
                        vertex(x+150, y+50);
                        vertex(x, y+50);

                        endShape(CLOSE);
                    },
                    x: 150+window.innerWidth/2-175,
                    y: 0+window.innerHeight/2-175,
                    wx: window.innerWidth,
                    wy: window.innerHeight,
                },
                {
                    draw: function(x,y){
                        noStroke();
                        fill(50,200,200);

                        beginShape();

                        // vertices
                        vertex(x, y);
                        vertex(x+150, y);
                        vertex(x+150, y+100);
                        vertex(x+200, y+100);
                        vertex(x+200, y+200);
                        vertex(x, y+257.243);

                        endShape(CLOSE);
                    },
                    x: 150+window.innerWidth/2-175,
                    y: 50+window.innerHeight/2-175,
                    wx: window.innerWidth,
                    wy: window.innerHeight,
                },
                {
                    draw: function(x,y){
                        noStroke();
                        fill(200,200,50);

                        beginShape();

                        // vertices
                        vertex(x, y);
                        vertex(x+350, y);
                        vertex(x+350, y-100);


                        endShape(CLOSE);
                    },
                    x: 0+window.innerWidth/2-175,
                    y: 349.8+window.innerHeight/2-175,
                    wx: window.innerWidth,
                    wy: window.innerHeight,
                },                
                {
                    draw: function(x,y){
                        noStroke();
                        fill(255);
                        rect(x,y,50,50);
                    },
                    x: 0+window.innerWidth/2-275,
                    y: 0+window.innerHeight/2-275,
                    wx: window.innerWidth,
                    wy: window.innerHeight,
                },
            ];
            let selected = null;
            function checkMouse(shapes){
                let x = user.mX, y = user.mY;
                let shape1 = shapes[5];
                let shape2 = shapes[4];
                let shape3 = shapes[3];
                let shape4 = shapes[2];
                let shape5 = shapes[1];
                let shape6 = shapes[0];

                if (!user.mP) selected = null;

                if (
                    (x > shape1.x && x < shape1.x + 50 && y > shape1.y && y < shape1.y + 50)
                ){
                    cursor(HAND);
                    if (user.mP && selected === null) {selected = 5; bx = x; by = y; bsx = shape1.x; bsy = shape1.y;} else if (user.mP) {cursor(MOVE);}
                } else if (
                    (x < 350 + shape2.x && x > shape2.x + 350 + ( -350 * ((y - shape2.y + 100) / 100 )) && y < shape2.y && y > shape2.y + ( -100 * ((x- shape2.x) / 350 )))
                ){
                    cursor(HAND);
                    if (user.mP && selected === null) {selected = 4; bx = x; by = y; bsx = shape2.x; bsy = shape2.y;} else if (user.mP) {cursor(MOVE);}
                } else if (
                    (x > shape3.x && x < shape3.x + 150 && y > shape3.y && y < shape3.y + 100)
                    ||
                    (x > shape3.x && x < shape3.x + 200 && y > shape3.y + 100 && y < shape3.y + 200)
                    ||
                    (x > shape3.x && x < shape3.x + 200 *  (1 - (y - shape3.y - 400) / 50 ) && y > shape3.y + 200 && y < shape3.y + 200 + 50 * (1-(x - shape3.x) / 200))
                ){
                    cursor(HAND);
                    if (user.mP && selected === null) {selected = 3; bx = x; by = y; bsx = shape3.x; bsy = shape3.y;} else if (user.mP) {cursor(MOVE);}
                } else if (
                    (x > shape4.x && x < shape4.x + 200 && y > shape4.y && y < shape4.y + 50)
                    ||
                    (x > shape4.x + 150 && x < shape4.x + 200 && y > shape4.y + 50 && y < shape4.y + 150)
                ){
                    cursor(HAND);
                    if (user.mP && selected === null) {selected = 2; bx = x; by = y; bsx = shape4.x; bsy = shape4.y;} else if (user.mP) {cursor(MOVE);}
                } else if (
                    (x > shape5.x && x < shape5.x + 150 && y > shape5.y && y < shape5.y + 257.243)
                    ||
                    (x > shape5.x && x < shape5.x + (150 *  (1 - (y - shape5.y - 257.143) / (300-257.243))) && y > shape5.y + 257.243 && y < shape5.y + 257.243 + (50 * (1 - (x - shape5.x) / 150)))
                ){
                    cursor(HAND)
                    if (user.mP && selected === null) {selected = 1; bx = x; by = y; bsx = shape5.x; bsy = shape5.y;} else if (user.mP) {cursor(MOVE);}
                } else if (                    
                    (x > shape6.x && x < shape6.x + 150 && y > shape6.y && y < shape6.y + 50)
                ) {
                    cursor(HAND);
                    if (user.mP && selected === null) {selected = 0; bx = x; by = y; bsx = shape6.x; bsy = shape6.y;} else if (user.mP) {cursor(MOVE);}
                } else {
                    cursor(ARROW);
                }
            }
            let bx = 0, by = 0, bsx = 0, bsy = 0;
            function move () {
                if (selected !== null) {
                    let shape = shapes[selected];
                    let x = user.mX, y = user.mY;
                    shape.x = x - bx + bsx;
                    shape.y = y - by + bsy;
                }
            }
            function draw () {
                console.log(bx);
                background(0);
                stroke(255);
                strokeWeight(5);
                fill(0);
                rect(window.innerWidth/2-177.6, window.innerHeight/2-177.6, 355, 355);
                shapes.forEach(shape=>{
                    shape.draw(shape.x, shape.y);
                });
                checkMouse(shapes);
                move();
                user.update();
            }

            function windowResized() {
                resizeCanvas(windowWidth, windowHeight);
                shapes.forEach(shape=>{
                    shape.x = window.innerWidth/2-175 + (shape.x - (shape.wx/2-175))
                    shape.y = window.innerHeight/2-175 + (shape.y - (shape.wy/2-175))
                    shape.wx = window.innerWidth;
                    shape.wy = window.innerHeight;
                });
            }
    </script>
</body>
</html>
